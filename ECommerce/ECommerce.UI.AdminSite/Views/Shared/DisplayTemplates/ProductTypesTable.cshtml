@model IEnumerable<ProductTypeView>

@{ECommerceService eCommerce = (ECommerceService)ViewData[GlobalViewBagKeys.ECommerceService];}

<div class="table-responsive rounded">
	<table class="table table-striped table-bordered table-hover table-condensed table-sm table-secondary table-active">
		<thead class="thead-dark">
			<tr>
				<th class="w-25"></th>
				<th>Name</th>
				<th>Date Modified</th>
				<th>Status</th>
			</tr>
		</thead>
		<tbody>
			@{string formAction = Url.Action("ChangeStatus", "ProductType");}
			@foreach (ProductTypeView productType in Model)
			{
				ProductView product = eCommerce.GetRepresentativeProduct(productType.Id);
				if (product == null)
				{
					product=new ProductView
					{
						ProductTypeName=productType.Name,
						ProductTypeId=productType.Id
					};
				}
				<tr class="productTypeRow">
					<td>
						@if (product.RepresentativeImage != null)
						{
							<img class="img-fluid rounded" src="@($"{UIConsts.GetProductUrlById(product.SellerId, product.ProductTypeId)}/{product.RepresentativeImage}")" alt="@product.ProductTypeName" />
						}
						else
						{
							<img class="img-fluid rounded" src="~/images/sample.png" alt="@product.ProductTypeName" />
						}
					</td>
					<td>
						<h4><a asp-action="Informations" asp-controller="ProductType" asp-route-productTypeId="@product.ProductTypeId" class="text-decoration-none">@product.ProductTypeName</a></h4>
						@{
							int categoryId = eCommerce.GetProductTypeBy(product.ProductTypeId).CategoryId;
							<small>
								@await Component.InvokeAsync("CategoryBreadCrumb", new { categoryId })
							</small>
						}
					</td>
					<td><input class="form-control" type="date" name="dateModified" readonly value="@productType.DateModified.ToString("yyyy-MM-dd")" /></td>
					<td>
						<form action="@formAction" method="post">
							<input name="productTypeId" type="hidden" value="@productType.Id" />
							<select class="submitOnChange form-control" name="status" enum-type="typeof(ProductTypeStatus)" selected="productType.Status"></select>
						</form>
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>

<script type="text/javascript">
	//change user status

	$('.submitOnChange').change(function () {
		var $form = $(this).closest('form');
		$.ajax({
			url: $form.attr('action'),
			type: $form.attr('method'),
			data: $form.serialize(),
			success: function (result) {
				if (result != '')
					alert(result);
			},
			error: function (result) {
				alert('something went wrong while changing product type status:\n' + result);
			}
		});
	});
</script>