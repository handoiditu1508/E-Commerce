@model IEnumerable<CustomerView>

<div class="table-responsive rounded">
	<table class="table table-striped table-bordered table-hover table-condensed table-sm table-secondary table-active">
		<thead class="thead-dark">
			<tr>
				<th>Email</th>
				<th>First Name</th>
				<th>Middle Name</th>
				<th>Last Name</th>
				<th>Active</th>
			</tr>
		</thead>
		<tbody>
			@{string formAction = Url.Action("ChangeActive", "Customer");}
			@foreach (CustomerView customer in Model)
			{
				<tr>
					<td><a href="#" class="text-decoration-none">@customer.Email</a></td>
					<td>@customer.FirstName</td>
					<td>@customer.MiddleName</td>
					<td>@customer.LastName</td>
					<td>
						<form action="@formAction" method="post">
							<input type="hidden" name="customerId" value="@customer.Id" />
							<input @(customer.Active ? "checked" : "") class="submitOnChange" name="active"
								   type="checkbox" data-toggle="toggle" value="true"
								   data-onstyle="success" data-offstyle="danger" data-size="small"
								   data-on="<i class='fas fa-lock-open'></i>"
								   data-off="<i class='fa fa-lock'></i>" />
						</form>
					</td>
					<td><a asp-action="Order" asp-controller="Customer" asp-route-customerId="@customer.Id" class="btn btn-sm btn-primary">View orders</a></td>
				</tr>
			}
		</tbody>
	</table>
</div>

<script type="text/javascript">
	//change user active

	$('.submitOnChange').change(function () {
		var $form = $(this).closest('form');
		$.ajax({
			url: $form.attr('action'),
			type: $form.attr('method'),
			data: $form.serialize(),
			success: function (result) {
				if (result != '')
					alert(result);
			},
			error: function (result) {
				alert('something went wrong while changing user active:\n' + result);
			}
		});
	});
</script>