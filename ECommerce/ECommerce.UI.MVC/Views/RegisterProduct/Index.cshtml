@model RegisterProductViewModel

@{
	ECommerceService eCommerce = (ECommerceService)ViewData[GlobalViewBagKeys.ECommerceService];
	ProductTypeView productType = eCommerce.GetProductTypeBy(Model.AddModel.ProductTypeId);
	<h1>@productType.Name</h1>
}
<form asp-action="Index" method="post" enctype="multipart/form-data">
	<div asp-validation-summary="ModelOnly" class="text-danger"></div>

	<input type="hidden" asp-for="AddModel.ProductTypeId" />

	<div class="form-group">
		<label asp-for="AddModel.Price" class="control-label"></label>
		<input asp-for="AddModel.Price" class="form-control" />
		<span asp-validation-for="AddModel.Price" class="text-danger"></span>
	</div>

	<div class="form-group">
		<label asp-for="AddModel.Model" class="control-label"></label>
		<select asp-for="AddModel.Model" asp-items="Html.GetEnumSelectList<OperatingModel>()"></select>
		<span asp-validation-for="AddModel.Model" class="text-danger"></span>
	</div>

	<table class="table table-striped table-bordered table-hover table-condensed table-sm table-active table-secondary mw-100">
		<thead class="thead-dark">
			<tr>
				<th>Attribute</th>
				<th>Values</th>
			</tr>
		</thead>
		<tbody>
			@{
				short attributeCount = 0;
				if (Model.AddModel.Attributes != null)
				{
					foreach (var attribute in Model.AddModel.Attributes)
					{
						<tr>
							<td><input name="keys" class="form-control" type="text" value="@attribute.Key" /></td>
							<td>
								<input name="values" type="text" value="@string.Join(',', attribute.Value)" data-role="tagsinput" />
							</td>
						</tr>
						attributeCount++;
					}
				}
				while (attributeCount++ < Model.ProductAttributesNumber)
				{
					<tr>
						<td><input name="keys" class="form-control" type="text" /></td>
						<td>
							<input name="values" type="text" data-role="tagsinput" />
						</td>
					</tr>
				}
			}
		<tbody>
		<tfoot>
			<tr>
				<td colspan="2" class="changeAttributeNumber">
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text">Change attribute number here</span>
						</div>
						<input class="changeAttributeNumberValue form-control" asp-for="ProductAttributesNumber" type="number" />
						<input type="hidden" class="changeAttributeNumberUrl" value="@Url.Action("Index", new { productTypeId = Model.AddModel.ProductTypeId })" />
						<div class="input-group-append">
							<button class="changeAttributeNumberBtn btn btn-primary">Change</button>
						</div>
					</div>
				</td>
			</tr>
		</tfoot>
	</table>

	<div class="form-group">
		<label class="control-label">Product's representative image:</label>
		<div class="file-loading">
			<input class="file registerProductFileInput" name="representativeImage" type="file" />
		</div>
	</div>

	<div class="form-group">
		<label class="control-label">Product's images:</label>
		<div class="file-loading">
			<input class="file registerProductFileInput" name="images" type="file" multiple />
		</div>
	</div>

	<input type="submit" value="Register product" class="btn btn-success" />
	<input type="reset" class="btn btn-outline-secondary" value="Reset" />
</form>

<script type="text/javascript">
	//change attribute number on click
	$('.changeAttributeNumberBtn').click(function (event) {
		event.preventDefault();

		$container = $(this).closest('.changeAttributeNumber');

		$value = $container.find('.changeAttributeNumberValue').val();

		$link = $container.find('.changeAttributeNumberUrl').val();

		window.location.replace($link + '&productAttributesNumber=' + $value);
	});

	//upload images
	$('.registerProductFileInput').fileinput({
        allowedFileExtensions: ['jpg', 'png', 'gif', 'jpeg'],
		removeClass: 'btn btn-danger',
		showUpload: false,
		allowedFileTypes: ['image'],
		maxFileSize: '2000',
		theme: 'fas',
		browseOnZoneClick: 'true'
	});
</script>